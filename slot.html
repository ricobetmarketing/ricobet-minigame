<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Slot Realm ‚Äî Mega Slots (5 Spins)</title>
<style>
  :root{
    --bg:#0a0f1e; --panel:#121a33; --ink:#eaf2ff; --muted:#a6b4d6;
    --neon:#74f1ff; --gold:#ffd76a; --lime:#8EFF98; --shadow:rgba(0,0,0,.55);
  }
  *{box-sizing:border-box}
  html,body{height:100%}
  body{
    margin:0; color:var(--ink);
    background:radial-gradient(1200px 800px at 70% -10%, #18244d 0%, #0a0f1e 55%, #05070d 100%);
    font-family:ui-sans-serif,system-ui,-apple-system,"Segoe UI",Roboto,Arial;
    display:flex; align-items:center; justify-content:center;
  }
  a.back{
    position:fixed; left:12px; top:12px; z-index:10; text-decoration:none;
    background:rgba(0,0,0,.5); padding:8px 12px; border-radius:10px; color:#fff; font-weight:700;
  }
  .wrap{width:min(1100px,96vw); margin:0 auto; padding:28px 0 40px;}
  .card3d{
    position:relative; border-radius:22px; padding:18px;
    background:linear-gradient(180deg, #1b2a56, #0f1832);
    outline:1px solid rgba(255,255,255,.08); box-shadow:0 16px 60px var(--shadow);
  }
  .card3d:before{content:""; position:absolute; inset:0; border-radius:22px; pointer-events:none;
    background:conic-gradient(from 210deg at 50% 0%, rgba(255,255,255,.18), rgba(255,255,255,0) 30%),
               linear-gradient(180deg, rgba(255,255,255,.06), transparent 30%);}
  h1{margin:0 0 8px; font-size:20px; font-weight:800; text-transform:uppercase}
  p.sub{margin:0 0 14px; color:var(--muted)}

  /* Machine */
  .slot-shell{position:relative; border-radius:26px; padding:18px; background:linear-gradient(180deg,#071226,#030813);
    outline:1px solid rgba(255,255,255,.06); box-shadow: inset 0 0 50px rgba(116,241,255,.1), 0 18px 50px var(--shadow)}
  .slot-top{display:flex; align-items:center; justify-content:space-between; gap:10px; margin-bottom:12px}
  .meter{display:flex; gap:8px; flex-wrap:wrap}
  .badge{padding:8px 12px; border-radius:12px; background:linear-gradient(180deg,#0d1832,#0a1226);
    outline:1px solid rgba(255,255,255,.08); font-weight:700}
  .badge .v{color:var(--gold)}
  .reelbox{position:relative; border-radius:18px; padding:14px; background:linear-gradient(180deg,#0e1a3a,#0b142c);
    outline:1px solid rgba(255,255,255,.08); box-shadow: inset 0 -6px 0 rgba(0,0,0,.35), inset 0 30px 60px rgba(0,0,0,.45)}
  .reels{display:grid; grid-template-columns: repeat(6, 1fr); gap:10px; height:180px; perspective:900px}
  .reel{position:relative; border-radius:14px; overflow:hidden; background:linear-gradient(180deg,#101b3a,#0c142b);
    outline:1px solid rgba(255,255,255,.06); box-shadow: inset 0 1px 0 rgba(255,255,255,.05), inset 0 -4px 0 rgba(0,0,0,.45)}
  .col{position:absolute; inset:0; display:flex; flex-direction:column; align-items:center; gap:14px; padding:14px; transform-style:preserve-3d}
  .sym{width:100%; height:56px; display:grid; place-items:center; font-size:32px; font-weight:900; color:#fff;
    text-shadow:0 4px 14px rgba(0,0,0,.6); background:linear-gradient(180deg,#1b2a56,#0f1832); border-radius:12px; outline:1px solid rgba(255,255,255,.06)}
  .glow{position:absolute; inset:-20px; background:radial-gradient(200px 100px at 50% 0%, rgba(116,241,255,.15), transparent 70%); pointer-events:none}
  .controls{display:flex; align-items:center; justify-content:space-between; gap:12px; margin-top:12px}
  .lever{flex:1; display:flex; gap:10px}
  .btn{cursor:pointer; border:0; border-radius:16px; padding:14px 18px; font-weight:900; letter-spacing:.5px; text-transform:uppercase;
    background:linear-gradient(180deg,#1d2a52,#0e1935); color:var(--ink); outline:1px solid rgba(255,255,255,.1); box-shadow:0 12px 30px rgba(0,0,0,.35)}
  .btn.primary{background:linear-gradient(to right, #71e1ff, #25c3ff)}
  .btn:disabled{opacity:.5; pointer-events:none}
  .hint{font-size:12px; color:var(--muted)}
  .payout{margin-left:auto; font-weight:800; color:var(--lime)}
  .winflash{position:absolute; inset:0; border-radius:26px; pointer-events:none; opacity:0; transition:opacity .3s ease; background:
    radial-gradient(500px 200px at 50% -10%, rgba(255,255,255,.15), transparent 60%),
    radial-gradient(500px 200px at 50% 110%, rgba(255,235,140,.25), transparent 60%)}
  .slot-shell.win .winflash{opacity:1}
  #confetti{position:absolute; inset:0; pointer-events:none}

  /* Voucher modal */
  .overlay{position:fixed; inset:0; background:rgba(0,0,0,.75); display:none; place-items:center; z-index:9999}
  .overlay.show{display:grid}
  .modal{width:min(520px,92vw); border-radius:20px; background:linear-gradient(180deg,#0e1a3a,#0a1329); color:#fff; padding:22px;
         outline:1px solid rgba(255,255,255,.1); box-shadow:0 18px 60px rgba(0,0,0,.6)}
  .modal h3{margin:0 0 8px}
  .voucher{font-family:ui-monospace,SFMono-Regular,Menlo,monospace; font-size:18px; letter-spacing:.6px; padding:10px 12px; border-radius:10px;
           background:rgba(255,255,255,.08); border:1px dashed rgba(255,255,255,.25); text-align:center}
  .row{display:flex; gap:10px; margin-top:12px}
  .copy,.close{cursor:pointer; border:0; border-radius:12px; padding:10px 14px; font-weight:800}
  .copy{background:linear-gradient(to right,#71e1ff,#25c3ff)}
  .close{background:#fff; color:#061018}
  .small{font-size:12px; color:#cdd6f6; margin-top:6px}
</style>
</head>
<body>
  <a class="back" href="index.html">‚Üê Back</a>

  <div class="wrap">
    <div class="card3d">
      <h1>Mega Slots ‚Äî 5 Spins</h1>
      <p class="sub">Spin up to 5 times. A voucher appears randomly but is guaranteed by the last spin. After the voucher pops, the game ends.</p>

      <div class="slot-shell" id="slot">
        <div class="winflash"></div>
        <canvas id="confetti"></canvas>

        <div class="slot-top">
          <div class="meter">
            <div class="badge">Spins Left: <span class="v" id="spinsLeft">5</span></div>
            <div class="badge">Bet: <span class="v" id="bet">10</span></div>
          </div>
          <div class="badge">Last Win: <span class="v" id="lastWin">0</span></div>
        </div>

        <div class="reelbox">
          <div class="reels" id="reels"></div>
          <div class="glow"></div>
        </div>

        <div class="controls">
          <div class="lever">
            <button class="btn" id="minus">‚àí</button>
            <button class="btn" id="plus">+</button>
            <button class="btn primary" id="spin">Spin</button>
            <span class="hint">You will get a voucher within 5 spins.</span>
          </div>
          <div class="payout" id="payout"> </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Voucher Modal -->
  <div class="overlay" id="voucherOverlay" role="dialog" aria-modal="true">
    <div class="modal">
      <h3>üéâ Congratulations! Your Voucher</h3>
      <div class="voucher" id="voucherCode">CODE-XXXX-1234</div>
      <div class="row">
        <button class="copy" id="copyBtn">Copy Code</button>
        <button class="close" id="closeBtn">Close</button>
      </div>
      <div class="small">This game is complete. Come back from the landing page for other events.</div>
    </div>
  </div>

<script src="assets/common.js"></script>
<script>
/* ========= Guard: lock to SLOT path ========= */
const existingChoice = getChoice();
if (existingChoice && existingChoice !== 'slot') {
  alert('You already started Live. Slot is locked for this event.');
  location.replace('index.html');
}
/* ========= Config ========= */
const MAX_SPINS = 5;
const SLOT_STATE_KEY   = 'slot_spins_state_v1';   // {left:number, claimed:boolean}
const SLOT_VOUCHER_KEY = 'slot_voucher_code_v1';
const VOUCHER_CODES    = ['MEGA-777-10FS', 'MEGA-777-20FS', 'MEGA-777-BOOST']; // <-- EDIT YOUR CODES

/* ========= UI refs ========= */
const reelsEl   = document.getElementById('reels');
const betEl     = document.getElementById('bet');
const lastWinEl = document.getElementById('lastWin');
const payoutEl  = document.getElementById('payout');
const spinBtn   = document.getElementById('spin');
const minusBtn  = document.getElementById('minus');
const plusBtn   = document.getElementById('plus');
const slotShell = document.getElementById('slot');
const spinsLeftEl = document.getElementById('spinsLeft');

/* ========= State ========= */
const SYMBOLS=["üçí","üíé","7Ô∏è‚É£","‚≠ê","üîî","BAR"];
let BET=10, spinning=false, turbo=false, started=false;

function fmt(n){return Number(n).toLocaleString()}
function setBet(v){BET=Math.max(1, Math.min(100, v)); betEl.textContent=BET}
setBet(BET);

/* Load/save progress */
function loadState(){
  const raw = localStorage.getItem(SLOT_STATE_KEY);
  if (!raw) return { left: MAX_SPINS, claimed:false };
  try { return JSON.parse(raw); } catch { return { left: MAX_SPINS, claimed:false }; }
}
function saveState(s){ localStorage.setItem(SLOT_STATE_KEY, JSON.stringify(s)); }
function setVoucher(code){
  localStorage.setItem(SLOT_VOUCHER_KEY, code);
}

/* init */
let state = loadState();
spinsLeftEl.textContent = state.left;

/* if already claimed, end game */
if (state.claimed) {
  finishGame(localStorage.getItem(SLOT_VOUCHER_KEY) || 'VOUCHER-CLAIMED');
}

/* build reels */
function makeReel(){
  const reel=document.createElement('div'); reel.className='reel';
  const col=document.createElement('div'); col.className='col';
  const pool=[]; for(let i=0;i<16;i++){ pool.push(SYMBOLS[Math.floor(Math.random()*SYMBOLS.length)]) }
  pool.forEach(s=>{ const d=document.createElement('div'); d.className='sym'; d.textContent=s; col.appendChild(d); });
  reel.appendChild(col); return reel;
}
for(let i=0;i<6;i++){ reelsEl.appendChild(makeReel()); }

/* spin flow */
function spinOnce(){
  if(spinning) return;
  if(state.claimed) return;
  if(state.left <= 0) { maybeRevealVoucher(); return; }
  if(!started){ setChoice('slot'); started=true; } // Lock path on first real spin

  spinning=true; payoutEl.textContent=''; slotShell.classList.remove('win');

  const cols=[...document.querySelectorAll('.reel .col')];
  const results=[];
  cols.forEach((col,idx)=>{
    const dur=(turbo? 600: 1400) + idx*120;
    const start=performance.now();
    const anim=()=>{
      const t=performance.now()-start; const p=Math.min(1,t/dur);
      const offset= -(p * 14 * 56);
      col.style.transform=`translateY(${offset}px) rotateX(${p*15}deg)`;
      if(t<dur){ requestAnimationFrame(anim); }
      else{
        const s=SYMBOLS[Math.floor(Math.random()*SYMBOLS.length)];
        const d=document.createElement('div'); d.className='sym'; d.textContent=s; col.appendChild(d);
        col.style.transform='translateY(0)';
        while(col.children.length>16){ col.removeChild(col.firstChild) }
        results[idx]=s;
        if(results.filter(Boolean).length===cols.length){ evaluate(results) }
      }
    };
    requestAnimationFrame(anim);
  });
}

function evaluate(arr){
  // fun non-monetary ‚Äúwin text‚Äù
  const freq={}; arr.forEach(s=>freq[s]=(freq[s]||0)+1);
  let best=0; for(const k in freq){ if(freq[k]>best) best=freq[k]; }
  const msg = (best>=3) ? `Nice! ${best} of a kind` : `No line ‚Äî keep going`;
  payoutEl.textContent = msg;
  if(best>=3){ slotShell.classList.add('win'); burstConfetti(); }

  // reduce spins and maybe reveal voucher
  state.left = Math.max(0, state.left - 1);
  saveState(state);
  spinsLeftEl.textContent = state.left;
  maybeRevealVoucher();
}

function maybeRevealVoucher(){
  if(state.claimed) return;
  // Always reveal on last spin. Before that, ~30% chance per spin.
  const shouldReveal = (state.left === 0) || (Math.random() < 0.3);
  if(!shouldReveal) {
    spinning=false;
    if(state.left === 0) { // safety
      revealVoucher();
    }
    return;
  }
  revealVoucher();
}

function revealVoucher(){
  const code = VOUCHER_CODES[Math.floor(Math.random()*VOUCHER_CODES.length)];
  setVoucher(code);
  state.claimed = true;
  saveState(state);
  finishGame(code);
}

function finishGame(code){
  // Disable spin permanently
  spinBtn.disabled = true;
  minusBtn.disabled = true;
  plusBtn.disabled = true;
  // Show voucher modal
  document.getElementById('voucherCode').textContent = code;
  document.getElementById('voucherOverlay').classList.add('show');
}

/* UI events */
spinBtn.addEventListener('mousedown',()=>{ turbo=true; })
spinBtn.addEventListener('mouseup',()=>{ turbo=false; })
spinBtn.addEventListener('mouseleave',()=>{ turbo=false; })
spinBtn.addEventListener('click',spinOnce);
minusBtn.addEventListener('click',()=>setBet(BET-1));
plusBtn.addEventListener('click',()=>setBet(BET+1));

/* Confetti */
const canvas=document.getElementById('confetti'), ctx=canvas.getContext('2d');
function resize(){ canvas.width=canvas.clientWidth; canvas.height=canvas.clientHeight }
addEventListener('resize',resize); resize();
function burstConfetti(){
  const parts=[]; const N=80; for(let i=0;i<N;i++){ parts.push({x:Math.random()*canvas.width,y:-10,vx:(Math.random()-0.5)*2,vy:Math.random()*2+1,r:Math.random()*3+2,life:120+Math.random()*40}); }
  let t=0; (function loop(){
    t++; ctx.clearRect(0,0,canvas.width,canvas.height);
    parts.forEach(p=>{ p.x+=p.vx; p.y+=p.vy; p.vy+=0.02; p.life--; ctx.globalAlpha=Math.max(0,p.life/160); ctx.beginPath(); ctx.arc(p.x,p.y,p.r,0,Math.PI*2); ctx.fillStyle=`hsl(${(p.x+p.y)%360},100%,70%)`; ctx.fill(); });
    ctx.globalAlpha=1; if(t<170) requestAnimationFrame(loop); else ctx.clearRect(0,0,canvas.width,canvas.height);
  })();
}

/* Modal buttons */
document.getElementById('copyBtn').addEventListener('click',()=>{
  const code = document.getElementById('voucherCode').textContent.trim();
  navigator.clipboard.writeText(code).then(()=>{
    const btn = document.getElementById('copyBtn');
    btn.textContent = 'Copied!';
    setTimeout(()=>btn.textContent='Copy Code',1200);
  });
});
document.getElementById('closeBtn').addEventListener('click',()=>{
  document.getElementById('voucherOverlay').classList.remove('show');
});
</script>
</body>
</html>
