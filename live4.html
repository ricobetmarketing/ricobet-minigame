<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover"/>
<title>Live — Mini Blackjack</title>
<style>
  :root{--ink:#eaf2ff;--mut:#9fb0d9;--g1:#71e1ff;--g2:#25c3ff}
  *{box-sizing:border-box}html,body{height:100%}
  body{margin:0;color:var(--ink);background:radial-gradient(1200px 800px at 70% -10%,#18244d 0%,#0a0f1e 55%,#05070d 100%);font-family:ui-sans-serif,system-ui,-apple-system,"Segoe UI",Roboto,Arial;display:flex;align-items:center;justify-content:center;padding:20px}
  a.back{position:fixed;left:12px;top:12px;z-index:10;text-decoration:none;background:rgba(0,0,0,.5);padding:8px 12px;border-radius:10px;color:#fff;font-weight:700}
  .wrap{width:min(980px,96vw)}
  .card{position:relative;border-radius:22px;padding:18px;background:linear-gradient(180deg,#1b2a56,#0f1832);outline:1px solid rgba(255,255,255,.08);box-shadow:0 16px 60px rgba(0,0,0,.55)}
  h1{margin:0 0 8px;font-size:20px;font-weight:900;text-transform:uppercase}
  p.sub{margin:0 6px 16px;color:var(--mut)}
  .table{border-radius:18px;background:radial-gradient(closest-side,#13325f,#0e1f43);outline:1px solid rgba(255,255,255,.08);box-shadow:inset 0 0 60px rgba(0,0,0,.6);padding:16px}
  .row{display:flex;gap:10px;flex-wrap:wrap;align-items:center;justify-content:center}
  .hand{display:flex;gap:8px;min-height:100px;justify-content:center;align-items:center;margin:8px 0}
  .playing-card{width:64px;height:90px;border-radius:10px;background:radial-gradient(180px 120px at 50% -20%,#fff,#e9eefc 40%,#c8d4f3 100%);outline:2px solid #e5ecff;box-shadow:0 10px 24px rgba(0,0,0,.35);display:grid;place-items:center;font-weight:900;color:#1a2050}
  .down{background:linear-gradient(180deg,#0e1a3a,#0a1329);outline:1px solid rgba(255,255,255,.08)}
  .score{color:#ffd86a;font-weight:900;text-shadow:0 0 10px rgba(255,216,106,.6);margin:4px 0;text-align:center}
  .btn{border:0;border-radius:12px;padding:10px 14px;font-weight:900;cursor:pointer;background:linear-gradient(to right,var(--g1),var(--g2));color:#061018;box-shadow:0 0 18px rgba(113,225,255,.5), inset 0 -3px 0 rgba(0,0,0,.35)}
  .btn.ghost{background:#2b2b2b;color:#fff}
  .code{display:none;margin-top:10px;text-align:center;font-family:ui-monospace,SFMono-Regular,Menlo,monospace;letter-spacing:.5px;padding:10px 12px;border-radius:12px;background:#0a0d1a;outline:1px dashed rgba(160,220,255,.35)}
  .copy{display:none;margin-top:8px;border:0;border-radius:10px;padding:8px 10px;font-weight:900;background:#2b2b2b;color:#fff}
  .note{margin-top:8px;color:var(--mut);text-align:center;font-size:12px}
</style>
</head>
<body>
  <a class="back" href="index.html">← Back</a>
  <div class="wrap">
    <div class="card">
      <h1>Mini Blackjack</h1>
      <p class="sub">Beat the dealer to reveal your Live voucher. Dealing locks you to <b>Live</b> for this event.</p>

      <div class="table">
        <div class="score" id="status">Tap Deal</div>

        <div style="text-align:center;font-weight:900;margin-top:4px">Dealer</div>
        <div class="hand" id="dealerHand"></div>
        <div class="score" id="dealerScore">—</div>

        <div style="text-align:center;font-weight:900;margin-top:8px">You</div>
        <div class="hand" id="playerHand"></div>
        <div class="score" id="playerScore">—</div>

        <div class="row" style="margin-top:10px">
          <button class="btn" id="dealBtn">Deal</button>
          <button class="btn" id="hitBtn" disabled>Hit</button>
          <button class="btn ghost" id="standBtn" disabled>Stand</button>
        </div>

        <div class="code" id="codeBox">LIVE-BJ-XXXX</div>
        <div class="row"><button class="copy" id="copyBtn">Copy Code</button></div>
        <div class="note">Blackjack rules: A=1 or 11, Dealer stands on 17+</div>
      </div>
    </div>
  </div>

<script src="assets/common.js"></script>
<script>
const CLAIM_KEY='live_blackjack_claimed_v1', CODE='LIVE-BJ-21';
const dealerEl=document.getElementById('dealerHand'), playerEl=document.getElementById('playerHand');
const dealerScore=document.getElementById('dealerScore'), playerScore=document.getElementById('playerScore'), statusEl=document.getElementById('status');
const dealBtn=document.getElementById('dealBtn'), hitBtn=document.getElementById('hitBtn'), standBtn=document.getElementById('standBtn');
const codeBox=document.getElementById('codeBox'), copyBtn=document.getElementById('copyBtn');

const c=getChoice(); if(c && c!=='live'){ alert('You already started Slot. Live is locked for this event.'); location.replace('index.html'); }
const prior=localStorage.getItem(CLAIM_KEY); if(prior){ finalize(JSON.parse(prior).code||CODE); }

let deck=[], dealer=[], player=[], inRound=false, dealerHidden=true;

function makeDeck(){ const ranks=['A','2','3','4','5','6','7','8','9','10','J','Q','K']; const suits=['♠','♥','♦','♣']; const d=[]; suits.forEach(s=>ranks.forEach(r=>d.push({r,s}))); for(let i=d.length-1;i>0;i--){const j=(Math.random()* (i+1))|0; [d[i],d[j]]=[d[j],d[i]];} return d; }
function value(hand){ // Aces flexible
  let sum=0, aces=0;
  hand.forEach(c=>{ if(c.r==='A'){aces++; sum+=1} else if(['K','Q','J','10'].includes(c.r)){sum+=10}else sum+=Number(c.r) });
  while(aces>0 && sum+10<=21){ sum+=10; aces--; }
  return sum;
}
function render(){
  dealerEl.innerHTML=''; playerEl.innerHTML='';
  dealer.forEach((c,i)=>dealerEl.appendChild(cardEl(i===0 && dealerHidden ? null : c)));
  player.forEach(c=>playerEl.appendChild(cardEl(c)));
  dealerScore.textContent = dealerHidden ? '??' : value(dealer);
  playerScore.textContent = value(player);
}
function cardEl(c){
  const el=document.createElement('div'); el.className='playing-card';
  if(!c){ el.classList.add('down'); el.textContent=''; return el; }
  el.innerHTML = `<div>${c.r}</div>`;
  return el;
}
function deal(){
  setChoice('live');
  deck = makeDeck(); dealer=[]; player=[]; dealerHidden=true; inRound=true;
  player.push(deck.pop(), deck.pop()); dealer.push(deck.pop(), deck.pop());
  statusEl.textContent='Hit or Stand';
  hitBtn.disabled=false; standBtn.disabled=false; dealBtn.disabled=true;
  render();
  if(value(player)===21){ stand(); }
}
function hit(){
  if(!inRound) return;
  player.push(deck.pop()); render();
  const v=value(player);
  if(v>21){ statusEl.textContent='Bust! Dealer wins'; end(false); }
}
function stand(){
  if(!inRound) return;
  dealerHidden=false; render();
  // Dealer hits to 17+
  while(value(dealer)<17){ dealer.push(deck.pop()); render(); }
  const p=value(player), d=value(dealer);
  let win=false;
  if(d>21 || p>d) win=true;
  else if(p===d) { statusEl.textContent='Push'; end(false,true); return; }
  statusEl.textContent = win ? 'You win!' : 'Dealer wins';
  end(win);
}
function end(win,push=false){
  inRound=false; hitBtn.disabled=true; standBtn.disabled=true; dealBtn.disabled=false;
  if(win){ finalize(CODE); localStorage.setItem(CLAIM_KEY, JSON.stringify({code:CODE, ts:Date.now()})); }
  else if(push){ /* no voucher, just allow redeal */ }
  else { codeBox.style.display='inline-block'; codeBox.textContent='TRY-AGAIN-NEXT-TIME'; }
}
function finalize(code){
  codeBox.style.display='inline-block'; codeBox.textContent=code; copyBtn.style.display='inline-block';
  hitBtn.disabled=true; standBtn.disabled=true; dealBtn.disabled=true; dealerHidden=false; render();
}
copyBtn.addEventListener('click',()=>{ const t=codeBox.textContent.trim(); if(!t)return; navigator.clipboard.writeText(t).then(()=>{ copyBtn.textContent='Copied!'; setTimeout(()=>copyBtn.textContent='Copy Code',1200); });});
dealBtn.addEventListener('click',deal); hitBtn.addEventListener('click',hit); standBtn.addEventListener('click',stand);
render();
</script>
</body>
</html>
